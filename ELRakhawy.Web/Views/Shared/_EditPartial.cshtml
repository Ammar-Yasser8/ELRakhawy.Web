@using ELRakhawy.EL.ViewModels
@model StakeholderTypeViewModel

<form asp-action="Edit" method="post" id="editForm" enctype="multipart/form-data">
    <input type="hidden" asp-for="Id" />
    <div asp-validation-summary="ModelOnly" class="alert alert-danger mb-3 py-2"></div>

    <div class="row">
        <div class="col-12">
            <div class="mb-3">
                <label asp-for="Type" class="form-label fw-bold">النوع <span class="text-danger">*</span></label>
                <input asp-for="Type" class="form-control" placeholder="أدخل نوع صاحب المصلحة" />
                <span asp-validation-for="Type" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label asp-for="FinancialTransactionTypeId" class="form-label fw-bold">نوع المعاملة المالية <span class="text-danger">*</span></label>
                <select asp-for="FinancialTransactionTypeId" class="form-select">
                    <option value="">-- اختر نوع المعاملة المالية --</option>
                    @foreach (var type in Model.FinancialTransactionTypes)
                    {
                        <option value="@type.Id" selected="@(type.Id == Model.FinancialTransactionTypeId)">
                            @type.Type
                        </option>
                    }
                </select>
                <span asp-validation-for="FinancialTransactionTypeId" class="text-danger small"></span>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">الواجهات المرتبطة <span class="text-danger">*</span></label>
                <div class="card border">
                    <div class="card-header bg-light py-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="small">حدد الواجهات المرتبطة</span>
                            <div>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="selectAllFormsEdit">تحديد الكل</button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-1" id="deselectAllFormsEdit">إلغاء تحديد الكل</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body p-3">
                        <div class="row" style="max-height: 200px; overflow-y: auto;">
                            @for (int i = 0; i < Model.AvailableForms.Count; i++)
                            {
                                var isChecked = Model.SelectedFormIds?.Contains(Model.AvailableForms[i].Id) == true;
                                <div class="col-6 mb-2">
                                    <div class="form-check">
                                        <input type="checkbox"
                                               class="form-check-input"
                                               name="SelectedFormIds"
                                               value="@Model.AvailableForms[i].Id"
                                               id="form_edit_@Model.AvailableForms[i].Id"
                                               @(isChecked ? "checked" : "") />
                                        <label class="form-check-label small" for="form_edit_@Model.AvailableForms[i].Id">
                                            @Model.AvailableForms[i].FormName
                                        </label>
                                    </div>
                                </div>
                            }
                        </div>
                        <span id="formsValidationMsgEdit" class="text-danger small d-none">يجب اختيار واجهة واحدة على الأقل</span>
                    </div>
                </div>
            </div>

            <div class="mb-3">
                <label asp-for="Comment" class="form-label fw-bold">بيان</label>
                <textarea asp-for="Comment" class="form-control" rows="2" placeholder="أدخل بيان إضافي (اختياري)"></textarea>
                <span asp-validation-for="Comment" class="text-danger small"></span>
            </div>
        </div>
    </div>

    <div class="modal-footer border-top pt-3">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            <i class="fas fa-times me-1"></i>إلغاء
        </button>
        <button type="submit" class="btn btn-warning text-white" id="editSubmitBtn">
            <i class="fas fa-save me-1"></i>تحديث
        </button>
    </div>
</form>

<script>
    // Initialize Select2 for edit form
    $(document).ready(function() {
        // Auto-focus on first field
        $('#Type').focus();

        // Real-time validation
        $('#Type').on('input', function() {
            if ($(this).val().trim() === '') {
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        });

        $('#FinancialTransactionTypeId').on('change', function() {
            if (!$(this).val()) {
                $(this).addClass('is-invalid');
            } else {
                $(this).removeClass('is-invalid');
            }
        });
    });
</script>